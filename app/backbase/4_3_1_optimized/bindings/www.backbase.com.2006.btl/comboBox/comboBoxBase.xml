<?xml version="1.0" encoding="UTF-8"?><d:tdl xmlns="http://www.w3.org/1999/xhtml" xmlns:b="http://www.backbase.com/2006/btl" xmlns:bb="http://www.backbase.com/2006/client" xmlns:d="http://www.backbase.com/2006/tdl"><d:namespace name="http://www.backbase.com/2006/btl"><d:uses element="positionElement dimensionElement" src="../visualElement/visualElement.xml"/><d:uses element="dropDown" src="../dropDown/dropDown.xml"/><d:uses element="formList" src="../formList/formList.xml"/><d:uses element="focusableElement" src="../focus/focus.xml"/><d:element name="comboBoxBase" extends="b:dropDown b:formList b:positionElement b:dimensionElement b:focusableElement" abstract="true"><d:attribute name="readonly"><d:mapper type="text/javascript"><![CDATA[this.setReadOnly(btl.isTrueValue(name,value));]]></d:mapper></d:attribute><d:attribute name="filter" default="false"><d:mapper type="text/javascript"><![CDATA[if(btl.isFalseValue(name,value)){this.resetFilter();}]]></d:mapper></d:attribute><d:property name="selectedOption"><d:getter type="text/javascript"><![CDATA[var oSelectedOption=null;var aOptions=this.getProperty('options');for(var i=0,iMax=aOptions.length;iMax>i;i++){var oOption=aOptions[i];if(oOption.getProperty('selected')){oSelectedOption=oOption;break;}}return oSelectedOption;]]></d:getter><d:setter type="text/javascript"><![CDATA[if(value){if(bb.instanceOf(value,'http://www.backbase.com/2006/btl','comboBoxOptionBase')&&value.getProperty('parentNode')==this){value.setProperty('selected',true);}}else{this.handleSelectedOption(null);}]]></d:setter></d:property><d:property name="selectedIndex"><d:setter type="text/javascript"><![CDATA[if(value===-1){var oSelectedOption;while(oSelectedOption=this.getProperty('selectedOption')){oSelectedOption.setProperty('selected',false);}this.setLabel('');this.setValue('');}else{if(value>-1){var aOptions=this.getProperty('options');if(aOptions.length&&aOptions[value]){aOptions[value].setProperty('selected',true);}}}]]></d:setter><d:getter type="text/javascript"><![CDATA[var iSelectedIndex=-1;var aOptions=this.getProperty('options');for(var i=0,iMax=aOptions.length;iMax>i;i++){if(aOptions[i].getProperty('selected')){iSelectedIndex=i;break;}}return iSelectedIndex;]]></d:getter></d:property><d:property name="value"><d:setter type="text/javascript"><![CDATA[var aOptions=this.getProperty('options');var bIsOption=false;for(var i=0,iMax=aOptions.length;iMax>i;i++){var oOption=aOptions[i];if(oOption.getProperty('value')==value){oOption.setProperty('selected',true);bIsOption=true;break;}}if(!bIsOption){if(!this.getProperty('readOnly')){var oSelectedOption=this.getProperty('selectedOption');if(oSelectedOption){oSelectedOption.setProperty('selected',false);}this.setLabel(value);this.setValue(value);}}]]></d:setter><d:getter type="text/javascript"><![CDATA[var oSelectedOption=this.getProperty('selectedOption');var sValue='';if(oSelectedOption){sValue=oSelectedOption.getProperty('value');}else{if(!this.getProperty('readOnly')){sValue=this.getLabel();}}return sValue;]]></d:getter></d:property><d:property name="highlightIndex"><d:setter type="text/javascript"><![CDATA[var iCurrentIndex=this.getProperty('highlightIndex');var iOptionsLength=this.getProperty('options').length;if(iCurrentIndex>-1&&iOptionsLength>iCurrentIndex){this.removeHighlight(iCurrentIndex);}if(value>-1&&iOptionsLength>value){this.setHighlight(value);}if(value>=-1&&iOptionsLength>value){this._['_highlightIndex']=value;}]]></d:setter><d:getter type="text/javascript"><![CDATA[if(this._['_highlightIndex']===undefined){this._['_highlightIndex']=-1;}return this._['_highlightIndex'];]]></d:getter></d:property><d:property name="filter"><d:getter type="text/javascript"><![CDATA[return btl.isTrueValue(name,this.getAttribute(name));]]></d:getter><d:setter type="text/javascript"><![CDATA[if(value){this.setAttribute(name,'true');}else{this.removeAttribute(name);}]]></d:setter></d:property><d:property name="readOnly"><d:setter type="text/javascript"><![CDATA[if(value!=this.getProperty('readOnly')){value?this.setAttribute('readonly','readonly'):this.removeAttribute('readonly');}]]></d:setter><d:getter type="text/javascript"><![CDATA[return btl.isTrueValue('readonly',this.getAttribute('readonly'));]]></d:getter></d:property><d:property name="valueBeforeChange"/><d:property name="selectedIndexBeforeChange"/><d:method name="handleSelectedOption"><d:argument name="selectedOption"/><d:body type="text/javascript"><![CDATA[var iSelectedOptionIndex=-1;for(var i=0,aOptions=this.getProperty('options'),iMax=aOptions.length;i<iMax;i++){var oOption=aOptions[i];if(oOption.getProperty('selected')&&oOption!=selectedOption){oOption.setProperty('selected',false);}if(oOption==selectedOption){iSelectedOptionIndex=i;}}if(selectedOption){this.setLabel(selectedOption.getProperty('text'));}this.setProperty('highlightIndex',iSelectedOptionIndex);this.setValue(this.getProperty('value'));]]></d:body></d:method><d:method name="handleDeselectedOption"><d:argument name="deselectedOption"/><d:body type="text/javascript"><![CDATA[if(this.getProperty('selectedIndex')==-1){this.setProperty('highlightIndex',-1);}]]></d:body></d:method><d:method name="filter"><d:body type="text/javascript"><![CDATA[if(this._.__emptyDiv!=undefined){this._.__emptyDiv.parentNode.removeChild(this._.__emptyDiv);this._.__emptyDiv=undefined;}var sLabel=this.getLabel().toLowerCase();var bHasPartialMatches=this._.__hasPartialMatches;var bFilter=this.getProperty('filter');if(this._.__lastFilteredValue!=sLabel){this._.__lastFilteredValue=sLabel;var aOptions=this.getProperty('options');bHasPartialMatches=false;for(var i=0,iMax=aOptions.length;iMax>i;i++){var oOption=aOptions[i];var sOptionLabel=oOption.getProperty('text').toLowerCase();var bFullMatch=(sLabel==sOptionLabel);var bMatch=(sOptionLabel.indexOf(sLabel)==0);bHasPartialMatches|=bMatch;if(bFilter){if(bMatch){oOption.setProperty('filtered',false);}else{oOption.setProperty('filtered',true);}}if(bFullMatch){oOption.setProperty('selected',true);}else{oOption.setProperty('selected',false);}}this._.__hasPartialMatches=bHasPartialMatches;}if(bFilter){if(bHasPartialMatches){this.open();}else{if(this._.__emptyDiv==undefined){this._.__emptyDiv=document.createElement('div');this._.__emptyDiv.innerHTML='&#160;';this._.__emptyDiv=this.getProperty('dropDownElement').appendChild(this._.__emptyDiv);this.setProperty('highlightIndex',this.getProperty('selectedIndex'));}}}return bHasPartialMatches;]]></d:body></d:method><d:method name="resetFilter"><d:body type="text/javascript"><![CDATA[var aOptions=this.getProperty('options');this._.__lastFilteredValue=null;for(var i=aOptions.length-1;i>=0;i--){aOptions[i].setProperty('filtered',false);}]]></d:body></d:method><d:method name="close"><d:body type="text/javascript"><![CDATA[this.setProperty('highlightIndex',this.getProperty('selectedIndex'));this.resetFilter();this.callSuper('close');]]></d:body></d:method><d:constructor type="text/javascript"><![CDATA[this.callSuper();var oSelectedOption=this.getProperty('selectedOption');if(!oSelectedOption&&this.getProperty('readOnly')){var aOptions=this.getProperty('options');if(aOptions.length){aOptions[0].setProperty('selected',true);}}]]></d:constructor><d:handler event="change" type="text/javascript"><![CDATA[if(this.getProperty('selectedIndex')==-1){this.setValue(this.getProperty('value'));}]]></d:handler><d:handler event="DOMNodeInsertedIntoDocument" type="text/javascript"><![CDATA[var oSelectedOption=this.getProperty('selectedOption');if(oSelectedOption){this.setLabel(oSelectedOption.getProperty('text'));this.setValue(this.getProperty('value'));this.setProperty('highlightIndex',this.getProperty('selectedIndex'));}if(bb.browser.ie){var sDisplay=this.viewNode.style.display;this.viewNode.style.display='inline';var oForceRedraw=function(oNode){return function(){oNode.style.display=sDisplay;};}(this.viewNode);setTimeout(oForceRedraw,'0');}]]></d:handler><d:handler event="mousedown" type="text/javascript"><![CDATA[if(event.button==0){if(!this.getProperty('open')){if(this.getProperty('readOnly')||bb.selector.queryAncestor(event.viewTarget,'.btl-comboBox-button',this.viewNode)){this.open();}}else{if(this.getProperty('readOnly')&&!bb.selector.queryAncestor(event.viewTarget,'.btl-comboBox-dropDown',this.viewNode)||bb.selector.queryAncestor(event.viewTarget,'.btl-comboBox-button',this.viewNode)){this.close();}}if(!bb.browser.ie&&this.__mouseDown){event.preventDefault();}}if(!bb.browser.ie){this.focus();}]]></d:handler><d:handler event="mouseup" type="text/javascript"><![CDATA[if(this.__mouseDown){var oTarget=event.target;if(event.button==0){var oOption;while(oTarget!=this){if(bb.instanceOf(oTarget,'http://www.backbase.com/2006/btl','comboBoxOptionBase')){oOption=oTarget;break;}oTarget=oTarget.getProperty('parentNode');}if(oOption){this.close();var bSelected=oOption.getProperty('selected');oOption.setProperty('selected',true);if(this.getProperty('selectedIndexBeforeChange')!=this.getProperty('selectedIndex')){bb.command.fireEvent(this,'change',true,false);}}}}this.__mouseDown=false;]]></d:handler><d:handler event="mouseleave" type="text/javascript"><![CDATA[this.__mouseDown=false;]]></d:handler><d:handler event="keydown" type="text/javascript"><![CDATA[switch(event.keyIdentifier){case 'Down':event.preventDefault();if(event.altKey){if(!this.getProperty('open')){this.open();}else{this.close();}}else{var aOptions=this.getProperty('options');var iMax=aOptions.length-1;var iNextIndex=this.getProperty('highlightIndex')+1;while(iNextIndex<=iMax){var oNext=aOptions[iNextIndex];if(!oNext.getProperty('filtered')){oNext.setProperty('selected',true);if(this.getProperty('open')){bb.html.scrollIntoView(this.viewGate.rows[iNextIndex]);}break;}iNextIndex++;}}break;case 'Up':event.preventDefault();if(event.altKey){if(!this.getProperty('open')){this.open();}else{this.close();}}else{var aOptions=this.getProperty('options');var iMin=this.getProperty('readOnly')?0:-1;var iPrecedingIndex=this.getProperty('highlightIndex')-1;while(iPrecedingIndex>=iMin){if(iPrecedingIndex==-1){this.setProperty('selectedIndex',-1);}else{var oPreceding=aOptions[iPrecedingIndex];if(!oPreceding.getProperty('filtered')){oPreceding.setProperty('selected',true);if(this.getProperty('open')){bb.html.scrollIntoView(this.viewGate.rows[iPrecedingIndex]);}break;}}iPrecedingIndex--;}}break;case 'Enter':if(this.getProperty('open')){var iHighlightIndex=this.getProperty('highlightIndex');if(iHighlightIndex>-1){var aOptions=this.getProperty('options');aOptions[iHighlightIndex].setProperty('selected',true);}this.close();event.preventDefault();if(this.getProperty('valueBeforeChange')!=this.getProperty('value')){bb.command.fireEvent(this,'change',true,false);}}break;case 'U+001B':var iSelectedIndexBeforeChange=this.getProperty('selectedIndexBeforeChange');if(this.getProperty('selectedIndex')!=iSelectedIndexBeforeChange){this.setProperty('selectedIndex',iSelectedIndexBeforeChange);}if(this.getProperty('open')){this.close();}break;default:break;}]]></d:handler><d:handler event="textInput" type="text/javascript"><![CDATA[if(!this.getProperty('readOnly')&&(event.data.charCodeAt(0)!=27)){if(this.__timeoutFilter){clearTimeout(this.__timeoutFilter);}var oComboBox=this;this.__timeoutFilter=setTimeout(function(){oComboBox.filter();this.__timeoutFilter=null;},200);this.open();}]]></d:handler><d:handler event="keyup" type="text/javascript"><![CDATA[if(!this.getProperty('readOnly')){switch(event.keyIdentifier){case 'U+0008':case 'U+002E':if(this.__timeoutFilter){clearTimeout(this.__timeoutFilter);}var oComboBox=this;this.__timeoutFilter=setTimeout(function(){oComboBox.filter();this.__timeoutFilter=null;},200);break;}}]]></d:handler><d:handler event="focus" type="text/javascript"><![CDATA[this.setProperty('valueBeforeChange',this.getProperty('value'));this.setProperty('selectedIndexBeforeChange',this.getProperty('selectedIndex'));]]></d:handler><d:handler event="change" type="text/javascript"><![CDATA[this.setProperty('valueBeforeChange',this.getProperty('value'));this.setProperty('selectedIndexBeforeChange',this.getProperty('selectedIndex'));]]></d:handler><d:handler event="blur" type="text/javascript"><![CDATA[if(!this.__mouseDown&&this.getProperty('open')){this.close();}if(this.getProperty('filter')){this.resetFilter();}if(this.getProperty('valueBeforeChange')!=this.getProperty('value')){bb.command.fireEvent(this,'change',true,false);}]]></d:handler><d:handler event="DOMNodeInserted" type="text/javascript"><![CDATA[var oTarget=event.target;if(bb.instanceOf(oTarget,'http://www.backbase.com/2006/btl','comboBoxOptionBase')){if(oTarget.getProperty('selected')){this.handleSelectedOption(oTarget);}else{var iHighlightIndex=this.getProperty('highlightIndex');if(iHighlightIndex>-1){var iIndex=0;var oPreceding=oTarget;while(oPreceding=oPreceding.getProperty('previousSibling')){if(bb.instanceOf(oPreceding,'http://www.backbase.com/2006/btl','comboBoxOptionBase')){iIndex++;}}if(iHighlightIndex>=iIndex){this.setProperty('highlightIndex',iHighlightIndex+1);}}}}]]></d:handler><d:handler event="DOMNodeRemoved" type="text/javascript"><![CDATA[var oTarget=event.target;if(bb.instanceOf(oTarget,'http://www.backbase.com/2006/btl','comboBoxOptionBase')){if(oTarget.getProperty('selected')){this.setLabel('');this.setValue('');this.setProperty('highlightIndex',-1);}else{var iHighlightIndex=this.getProperty('highlightIndex');if(iHighlightIndex>-1){var iIndex=0;var oPreceding=oTarget;while(oPreceding=oPreceding.getProperty('previousSibling')){if(bb.instanceOf(oPreceding,'http://www.backbase.com/2006/btl','comboBoxOptionBase')){iIndex++;}}if(iHighlightIndex>iIndex){this._._highlightIndex=iHighlightIndex-1;}}}}]]></d:handler></d:element><d:element name="comboBoxOptionBase" extends="b:formListOption" abstract="true"><d:property name="selected"><d:getter type="text/javascript"><![CDATA[if(this._._selected===undefined){var sSelected=this.getAttribute('selected');this._._selected=btl.isTrueValue('selected',sSelected);}return this._['_selected'];]]></d:getter><d:setter type="text/javascript"><![CDATA[value=Boolean(value);if(this._._selected==value){return;}this._._selected=value;var oParent=this.getProperty('parentNode');if(oParent&&bb.instanceOf(oParent,'http://www.backbase.com/2006/btl','comboBoxBase')){value?oParent.handleSelectedOption(this):oParent.handleDeselectedOption(this);}var sEvent=value?'select':'deselect';bb.command.fireEvent(this,sEvent,false,false);]]></d:setter></d:property><d:property name="filtered"/></d:element><d:interface name="iComboBox"/></d:namespace></d:tdl>