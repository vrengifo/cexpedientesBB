<?xml version="1.0" encoding="UTF-8"?><d:tdl xmlns="http://www.w3.org/1999/xhtml" xmlns:b="http://www.backbase.com/2006/btl" xmlns:d="http://www.backbase.com/2006/tdl"><d:namespace name="http://www.backbase.com/2006/btl"><d:interface name="UIControl"/><d:element name="itemsSelectControl" abstract="true"><d:resource type="text/javascript"><![CDATA[btl.itemsSelectControl={};btl.itemsSelectControl.createItemsArray=function btl_itemsSelectControl_createItemsArray(oGrid,vStart,vEnd){var aIndexes=null;if(vEnd&&!(vStart instanceof Array)){aIndexes=oGrid.getItemsFromRange(vStart,vEnd);}else{aIndexes=(vStart instanceof Array)?vStart.slice(0):[vStart];}return aIndexes||[];};]]></d:resource><d:attribute name="selectType" default="single"><d:mapper type="text/javascript"><![CDATA[if(value!='single'&&value!='singleRequired'&&value!='multiple'){bb.command.trace(this,'Wrong selectType attribute value was assigned, changing to default!',2);this.modelNode.setAttribute('selectType','single');}]]></d:mapper></d:attribute><d:property name="selectedItems"><d:getter type="text/javascript"><![CDATA[return this._['_selectedItems']||[];]]></d:getter></d:property><d:method name="getItemsFromRange"><d:argument name="rangeStart" required="true"/><d:argument name="rangeEnd" required="true"/><d:body type="text/javascript"/></d:method><d:method name="selectItem"><d:argument name="item" required="true"/><d:body type="text/javascript"/></d:method><d:method name="deselectItem"><d:argument name="item" required="true"/><d:body type="text/javascript"/></d:method><d:method name="addToSelection"><d:argument name="item" required="true"/><d:argument name="toItem"/><d:body type="text/javascript"><![CDATA[var sSelType=this.getAttribute('selectType');var iAffected=0;if(sSelType=='singleRequired'||sSelType=='single'){return this.setSelection(item,toItem);}var aItems=btl.itemsSelectControl.createItemsArray(this,item,toItem);for(var iItem=0;iItem<aItems.length;++iItem){if(!this.isSelected(aItems[iItem])){this.selectItem(aItems[iItem]);++iAffected;}}return iAffected;]]></d:body></d:method><d:method name="removeFromSelection"><d:argument name="item" required="true"/><d:argument name="toItem"/><d:body type="text/javascript"><![CDATA[var sSelType=this.getAttribute('selectType');if(sSelType=='singleRequired'&&this.getProperty('selectedItems').length<2){return 0;}var aItems=btl.itemsSelectControl.createItemsArray(this,item,toItem);for(var iItem=0;iItem<aItems.length;++iItem){if(this.isSelected(aItems[iItem])){this.deselectItem(aItems[iItem]);}}return aItems.length;]]></d:body></d:method><d:method name="setSelection"><d:argument name="item" required="true"/><d:argument name="toItem"/><d:body type="text/javascript"><![CDATA[var sSelType=this.getAttribute('selectType');var aSelItems=this.getProperty('selectedItems').slice(0);var aItems=btl.itemsSelectControl.createItemsArray(this,item,toItem);if(sSelType=='single'||sSelType=='singleRequired'){aItems=[aItems[aItems.length-1]];}for(var iItem=0;iItem<aSelItems.length;++iItem){if(bb.array.indexOf(aItems,aSelItems[iItem])==-1){this.deselectItem(aSelItems[iItem]);}else{bb.array.removeObject(aItems,aSelItems[iItem]);}}for(var iItem=0;iItem<aItems.length;++iItem){this.selectItem(aItems[iItem]);}return aItems.length;]]></d:body></d:method><d:method name="toggleSelection"><d:argument name="item" required="true"/><d:body type="text/javascript"><![CDATA[var sSelType=this.getAttribute('selectType');var bSelected=this.isSelected(item);if((sSelType=='singleRequired')||(sSelType=='single'&&!bSelected)){return Boolean(this.setSelection(item));}if(bSelected){return Boolean(this.removeFromSelection(item));}else{return Boolean(this.addToSelection(item));}]]></d:body></d:method><d:method name="clearSelection"><d:body type="text/javascript"><![CDATA[var sSelType=this.getAttribute('selectType');var aSelItems=this.getProperty('selectedItems').slice(0);if(sSelType=='singleRequired'){aSelItems=(aSelItems.length==1)?[]:aSelItems.slice(0,aSelItems.length-1);}this.removeFromSelection(aSelItems);]]></d:body></d:method><d:method name="isSelected"><d:argument name="item" required="true"/><d:body type="text/javascript"><![CDATA[return (bb.array.indexOf(this.getProperty('selectedItems'),item)!=-1);]]></d:body></d:method></d:element><d:element name="itemsEditor" abstract="true"><d:resource type="text/javascript"><![CDATA[btl.itemsEditor={};btl.itemsEditor.getValue=function(oEditor){if(oEditor===null){return null;}if(oEditor._){if(bb.instanceOf(oEditor,btl.namespaceURI,'formField')){return oEditor.getProperty('value');}if(bb.instanceOf(oEditor,'http://www.w3.org/1999/xhtml','xhtmlControlElement')){if(oEditor.getProperty('type')=='checkbox'){return oEditor.getProperty('checked')?oEditor.getProperty('value'):'';}return oEditor.getProperty('value');}}if(oEditor.tagName&&(oEditor.tagName.toLowerCase()=='input'||oEditor.tagName.toLowerCase()=='textarea'||oEditor.tagName.toLowerCase()=='select')){if(oEditor.type=='checkbox'){return oEditor.checked?oEditor.value:'';}return oEditor.value;}return null;};btl.itemsEditor.setValue=function(oEditor,mValue){if(oEditor===null){return false;}if(oEditor._){if(bb.instanceOf(oEditor,btl.namespaceURI,'formField')){oEditor.setProperty('value',mValue);return true;}if(bb.instanceOf(oEditor,'http://www.w3.org/1999/xhtml','xhtmlControlElement')){if(oEditor.getProperty('type')=='checkbox'){(oEditor.getProperty('value')==mValue)?oEditor.setProperty('checked',true):oEditor.setProperty('checked',false);return true;}oEditor.setProperty('value',mValue);return true;}}if(oEditor.tagName&&(oEditor.tagName.toLowerCase()=='input'||oEditor.tagName.toLowerCase()=='textarea'||oEditor.tagName.toLowerCase()=='select')){if(oEditor.type=='checkbox'){(oEditor.value==mValue)?(oEditor.checked=true):oEditor.checked=false;return true;}oEditor.value=mValue;return true;}return false;};btl.itemsEditor._stopEdit=function(oController,bSave){if(!oController.isEdited()){return false;}var aEditInfo=oController._._itemEditInfo,oInfo=null;if(bSave){for(var iInfoItem=0;iInfoItem<aEditInfo.length;++iInfoItem){oInfo=aEditInfo[iInfoItem];var value=btl.itemsEditor.getValue(oInfo.editor);if(oInfo.value!=value){aEditInfo[iInfoItem].newValue=value;}oController.hideEditor(oInfo.editor,oInfo.viewNode);}oController.updateEditItem(oController._._editItem,aEditInfo);}else{for(var iInfoItem=0;iInfoItem<aEditInfo.length;++iInfoItem){oController.hideEditor(aEditInfo[iInfoItem].editor,aEditInfo[iInfoItem].viewNode);}}oController._._editItem=null;oController._._itemEditInfo=null;var oEvent=bb.document.createEvent('Event');oEvent.initEvent(bSave?'editConfirm':'editCancel',false,false);oController.dispatchEvent(oEvent);return true;};]]></d:resource><d:method name="startEdit"><d:argument name="item"/><d:argument name="focusedEditor"/><d:body type="text/javascript"><![CDATA[if(this._._editItem!==null||item===null){return false;}var aEditInfo=this._._itemEditInfo=this.getEditInformation(item);var oInfo=null,bEmpty=true;for(var iInfoItem=0;iInfoItem<aEditInfo.length;++iInfoItem){oInfo=aEditInfo[iInfoItem];this.placeEditor(oInfo.editor,oInfo.viewNode)&&btl.itemsEditor.setValue(oInfo.editor,oInfo.value)&&(bEmpty=false);if(!focusedEditor&&!bEmpty){focusedEditor=oInfo.editor;}}this._._editItem=item;var oEvent=bb.document.createEvent('Event');oEvent.initEvent('editStart',false,false);this.dispatchEvent(oEvent);if(bEmpty){this.cancelEdit();return false;}else{focusedEditor.focus();}return true;]]></d:body></d:method><d:method name="confirmEdit"><d:body type="text/javascript"><![CDATA[return btl.itemsEditor._stopEdit(this,true);]]></d:body></d:method><d:method name="cancelEdit"><d:body type="text/javascript"><![CDATA[return btl.itemsEditor._stopEdit(this,false);]]></d:body></d:method><d:method name="isEdited"><d:body type="text/javascript"><![CDATA[return (this._._editItem!==null);]]></d:body></d:method><d:method name="placeEditor"><d:argument name="editor"/><d:argument name="viewNode"/><d:body type="text/javascript"><![CDATA[if(!editor||!viewNode){return false;}editor.__replacedContent=[];while(viewNode.firstChild){editor.__replacedContent.push(viewNode.removeChild(viewNode.firstChild));}viewNode.appendChild(editor.viewNode||editor);return true;]]></d:body></d:method><d:method name="hideEditor"><d:argument name="editor"/><d:argument name="viewNode"/><d:body type="text/javascript"><![CDATA[if(!editor||!viewNode){return false;}var oEditorView=editor.viewNode||editor;viewNode.removeChild(oEditorView);for(var iChild=0;iChild<editor.__replacedContent.length;++iChild){viewNode.appendChild(editor.__replacedContent[iChild]);}return true;]]></d:body></d:method><d:method name="updateEditItem"><d:argument name="item"/><d:argument name="values"/><d:body type="text/javascript"/></d:method><d:method name="getEditInformation"><d:argument name="item"/><d:body type="text/javascript"/></d:method><d:handler event="construct" type="text/javascript"><![CDATA[this._._itemEditors=null;this._._editItem=null;]]></d:handler></d:element><d:behavior name="userSelect"><d:resource type="text/javascript"><![CDATA[btl.userSelect={};btl.userSelect.findTargetByClass=function btl_userSelect_findEventTargetByClass(oElement,sClass,oRoot){oRoot=oRoot||document.body;while(oElement){if(typeof oElement.className=='string'&&bb.html.hasClass(oElement,sClass)){return oElement;}if(oElement==oRoot){return null;}oElement=oElement.parentNode;}return null;};btl.userSelect.focusModifiers={'Up':['vertical',-1],'Down':['vertical',1],'Left':['horizontal',-1],'Right':['horizontal',1],'Home':['vertical','first'],'End':['vertical','last'],'PageUp':['vertical',-10],'PageDown':['vertical',10]};btl.userSelect.selectionModifiers=['Up','Down','Left','Right','Home','End','PageUp','PageDown','U+0020','Enter'];]]></d:resource><d:method name="resetRangeAnchor"><d:body type="text/javascript"><![CDATA[this.__rangeAnchor=null;this.__prevSelectedRange=null;]]></d:body></d:method><d:handler event="construct" type="text/javascript"><![CDATA[if(!bb.instanceOf(this,btl.namespaceURI,'UIControl')){bb.command.trace(this,'userSelect behavior was applied to the element that does not implement UIControl class. This can lead to runtime errors in this object!',3);}]]></d:handler><d:handler event="mousedown" type="text/javascript"><![CDATA[var oTarget=btl.userSelect.findTargetByClass(event.viewTarget,'btl-userSelect-item',this.viewNode);if(!oTarget){return true;}if(event.shiftKey&&!this.__rangeAnchor){this.__rangeAnchor=this.execUIQuery('get_focused_item_view');}else{if(!event.shiftKey){this.resetRangeAnchor();}}var sCommand='clear_and_select_item';var ctrlKey=event.ctrlKey||event.metaKey;if(event.shiftKey&&this.__rangeAnchor){sCommand=this.__prevSelectedRange?'replace_items_range':((ctrlKey?'':'clear_and_')+'select_items_range');}else{if(ctrlKey){sCommand='toggle_item_selection';}}var aArguments=[oTarget];switch(sCommand){case 'clear_and_select_items_range':case 'select_items_range':aArguments[1]=aArguments[0];aArguments[0]=this.__rangeAnchor;this.__prevSelectedRange=[aArguments[0],aArguments[1]];break;case 'replace_items_range':aArguments[0]=this.__prevSelectedRange;aArguments[1]=[this.__rangeAnchor,oTarget];this.__prevSelectedRange=[this.__rangeAnchor,oTarget];break;}this.execUICommand('move_focus_to',[oTarget]);this.execUICommand(sCommand,aArguments);]]></d:handler><d:handler event="keydown" type="text/javascript"><![CDATA[var sKey=event.keyIdentifier;var aFocusModifier=btl.userSelect.focusModifiers[sKey];var bSelectionModifier=bb.array.indexOf(btl.userSelect.selectionModifiers,sKey)!=-1;var ctrlKey=event.metaKey||event.ctrlKey;var sCommand=(ctrlKey?'':'clear_and_')+'select_item',aArguments=[];var oFocusedItem=this.execUIQuery('get_focused_item_view');if(event.shiftKey){this.__rangeAnchor=this.__rangeAnchor||oFocusedItem;}else{this.resetRangeAnchor();}if(aFocusModifier){this.execUICommand('move_focus_for',aFocusModifier);}if(bSelectionModifier){if(sKey=='U+0020'||sKey=='Enter'){sCommand='clear_and_select_item';if(navigator.platform.indexOf('Mac')!=-1||ctrlKey){sCommand=(sKey=='Enter')?'select_item':'toggle_item_selection';}this.execUICommand(sCommand,[oFocusedItem]);}else{if(!ctrlKey||event.shiftKey){aArguments[0]=this.execUIQuery('get_focused_item_view');if(event.shiftKey&&!this.__prevSelectedRange){aArguments[1]=aArguments[0];aArguments[0]=this.__rangeAnchor;sCommand+='s_range';this.__prevSelectedRange=[aArguments[0],aArguments[1]];}else{if(event.shiftKey){sCommand='replace_items_range';aArguments=[[this.__prevSelectedRange[0],this.__prevSelectedRange[1]],[this.__rangeAnchor,aArguments[0]]];this.__prevSelectedRange=[aArguments[1][0],aArguments[1][1]];}else{if(this.__prevSelectedRange){this.__prevSelectedRange=null;}}}this.execUICommand(sCommand,aArguments);}}event.preventDefault();}]]></d:handler></d:behavior><d:behavior name="userEdit"><d:resource type="text/javascript"><![CDATA[btl.userEdit={};btl.userEdit._editedItemView=null;btl.userEdit._editedElement=null;btl.userEdit.documentMouseDown=function(oEvent){var oContr=btl.userEdit._editedElement;if(!oContr){return true;}if(oContr.execUIQuery('is_edited_item',[oEvent.target,oEvent.viewTarget])){return true;}oContr.execUICommand('confirm_edit');};bb.document.addEventListener('mousedown',btl.userEdit.documentMouseDown,true);]]></d:resource><d:handler event="construct" type="text/javascript"><![CDATA[if(!bb.instanceOf(this,btl.namespaceURI,'UIControl')){bb.command.trace(this,'userEdit behavior was applied to the element that does not implements UIControl class. This can lead to runtime errors in this object!',3);}]]></d:handler><d:handler event="keydown" type="text/javascript"><![CDATA[var bEdited=this.execUIQuery('is_edited');var oFocusedItem=this.execUIQuery('get_focused_item_view');var sKey=event.keyIdentifier;switch(true){case Boolean(!bEdited&&(sKey=='Enter'||sKey=='F2')):this.execUICommand('start_edit',[oFocusedItem]);break;case Boolean(bEdited&&(sKey=='Enter'||sKey=='U+001B')):this.execUICommand((sKey=='Enter'?'confirm':'cancel')+'_edit');break;}]]></d:handler><d:handler event="dblclick" type="text/javascript"><![CDATA[var oToFocus=btl.userSelect.findTargetByClass(event.viewTarget,'btl-userEdit-focusable',this.viewNode);var oTarget=btl.userSelect.findTargetByClass(oToFocus||event.viewTarget,'btl-userEdit-item',this.viewNode);var bEdited=this.execUIQuery('is_edited');if(oTarget&&!bEdited){this.execUICommand('start_edit',[oTarget,oToFocus]);}else{if(oTarget&&oTarget!=btl.userEdit._editedItemView){this.execUICommand('confirm_edit');this.execUICommand('start_edit',[oTarget,oToFocus]);}}]]></d:handler><d:handler event="editStart" type="text/javascript"><![CDATA[btl.userEdit._editedElement=this;]]></d:handler><d:handler event="editConfirm" type="text/javascript"><![CDATA[btl.userEdit._editedElement=null;]]></d:handler><d:handler event="editCancel" type="text/javascript"><![CDATA[btl.userEdit._editedElement=null;]]></d:handler></d:behavior></d:namespace></d:tdl>