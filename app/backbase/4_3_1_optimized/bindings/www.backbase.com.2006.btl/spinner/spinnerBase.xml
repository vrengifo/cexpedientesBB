<?xml version="1.0" encoding="UTF-8"?><d:tdl xmlns="http://www.w3.org/1999/xhtml" xmlns:b="http://www.backbase.com/2006/btl" xmlns:bb="http://www.backbase.com/2006/client" xmlns:d="http://www.backbase.com/2006/tdl"><d:namespace name="http://www.backbase.com/2006/btl"><d:uses element="focusableElement" src="../focus/focus.xml"/><d:uses element="rangeFormField" src="../rangeFormField/rangeFormField.xml"/><d:uses element="positionElement dimensionElement" src="../visualElement/visualElement.xml"/><d:element name="spinnerBase" extends="b:rangeFormField b:positionElement b:dimensionElement b:focusableElement" abstract="true"><d:attribute name="value"/><d:attribute name="step" default="1"/><d:attribute name="decimals" default="0"/><d:attribute name="stringBefore"/><d:attribute name="stringAfter"/><d:property name="defaultValue"/><d:property name="value"/><d:constructor type="text/javascript"><![CDATA[if(!this.hasAttribute('value')){var sMinValue=this.getAttribute('min');this.setProperty('value',sMinValue);this.setProperty('defaultValue',sMinValue);}var me=this;this.__spinnerStopTimer=function spinnerStopTimer(){if(me.__timer){clearTimeout(me.__timer);me.__timer=null;var sNewValue=me.getProperty('value');if(me.__valueOnFocus!=sNewValue){me.__valueOnFocus=sNewValue;bb.command.fireEvent(me,'change',true,false);}}bb.document.removeEventListener('mousemove',arguments.callee,false);};]]></d:constructor><d:method name="increaseValue"><d:argument name="continuous"/><d:body type="text/javascript"><![CDATA[var sValue=this.getProperty('value');var fValue=parseFloat(sValue);if(!isNaN(fValue)){var newValue=fValue+parseFloat(this.getAttribute('step'));var iDecimals=parseInt(this.getAttribute('decimals'));newValue=newValue.toFixed(iDecimals);this.setProperty('value',newValue);if(continuous){var me=this;var bFirstStart=this.__timer?false:true;this.__timer=setTimeout(function(){me.increaseValue(true);},bFirstStart?1000:100);if(bFirstStart){bb.document.addEventListener('mouseup',this.__spinnerStopTimer,false);}}}]]></d:body></d:method><d:method name="decreaseValue"><d:argument name="continuous"/><d:body type="text/javascript"><![CDATA[var sValue=this.getProperty('value');var fValue=parseFloat(sValue);if(!isNaN(fValue)){var newValue=fValue-parseFloat(this.getAttribute('step'));var iDecimals=parseInt(this.getAttribute('decimals'));newValue=newValue.toFixed(iDecimals);this.setProperty('value',newValue);if(continuous){var me=this;var bFirstStart=this.__timer?false:true;this.__timer=setTimeout(function(){me.decreaseValue(true);},bFirstStart?1000:100);if(bFirstStart){bb.document.addEventListener('mouseup',this.__spinnerStopTimer,false);}}}]]></d:body></d:method><d:method name="formatValue"><d:argument name="value"/><d:body type="text/javascript"><![CDATA[value=String(value);var sStringBefore=this.getAttribute('stringBefore');var sStringAfter=this.getAttribute('stringAfter');value=parseFloat(value);var iDecimals=parseInt(this.getAttribute('decimals'));value=value.toFixed(iDecimals);return sStringBefore+value+sStringAfter;]]></d:body></d:method><d:method name="unformatValue"><d:argument name="value"/><d:body type="text/javascript"><![CDATA[value=String(value);var sStringBefore=this.getAttribute('stringBefore');var sStringAfter=this.getAttribute('stringAfter');if(value.substr(0,sStringBefore.length)==sStringBefore){value=value.substr(sStringBefore.length);}if(value.substr(value.length-sStringAfter.length,value.length)==sStringAfter){value=value.substring(0,value.length-sStringAfter.length);}var iDecimals=parseInt(this.getAttribute('decimals'));value=parseFloat(''+value);value=value.toFixed(iDecimals);return value+'';]]></d:body></d:method><d:method name="isCorrectValue"><d:argument name="value"/><d:body type="text/javascript"><![CDATA[var fValue=parseFloat(''+value);var fMin=parseFloat(this.getAttribute('min'));var fMax=parseFloat(this.getAttribute('max'));if(!isNaN(fValue)){if(fValue<fMin){fValue=fMin;}else{if(fValue>fMax){fValue=fMax;}}return ''+fValue;}return false;]]></d:body></d:method><d:method name="handleChangeEvent"><d:body type="text/javascript"><![CDATA[var sValue=this.getProperty('value');sValue==this.unformatValue(sValue);var fValue=parseFloat(sValue);if(isNaN(fValue)){this.setProperty('value',this.getProperty('value'));}else{this.setProperty('value',sValue);}]]></d:body></d:method><d:handler event="focus" type="text/javascript"><![CDATA[this.__valueOnFocus=this.getProperty('value');]]></d:handler><d:handler event="blur" type="text/javascript"><![CDATA[if(this.__valueOnFocus!=this.getProperty('value')){bb.command.fireEvent(this,'change',true,false);}]]></d:handler><d:handler event="mousedown" match=".btl-spinner-upButton" type="text/javascript"><![CDATA[event.preventDefault();this.viewNode.getElementsByTagName('input')[0].focus();this.increaseValue(true);]]></d:handler><d:handler event="mousedown" match=".btl-spinner-downButton" type="text/javascript"><![CDATA[event.preventDefault();this.viewNode.getElementsByTagName('input')[0].focus();this.decreaseValue(true);]]></d:handler><d:handler event="mouseup" type="text/javascript"><![CDATA[clearTimeout(this.__timer);this.__timer=null;var sNewValue=this.getProperty('value');if(this.__valueOnFocus!=sNewValue){this.__valueOnFocus=sNewValue;bb.command.fireEvent(this,'change',true,false);}]]></d:handler><d:handler event="mousewheel" type="application/javascript"><![CDATA[if(event.target==this){if(!event.defaultPrevented){if(event.wheelDelta>0){this.decreaseValue();}else{this.increaseValue();}event.preventDefault();}}]]></d:handler><d:handler event="keydown" type="text/javascript"><![CDATA[var iType=event.keyIdentifier=='Up'?1:(event.keyIdentifier=='Down'?-1:0);if(iType!=0){if(iType>0){this.increaseValue();}else{this.decreaseValue();}event.preventDefault();}]]></d:handler><d:handler event="keyup" type="text/javascript"><![CDATA[if(event.keyIdentifier=='Up'||event.keyIdentifier=='Down'){var sNewValue=this.getProperty('value');if(this.__valueOnFocus!=sNewValue){this.__valueOnFocus=sNewValue;bb.command.fireEvent(this,'change',true,false);}}]]></d:handler></d:element></d:namespace></d:tdl>