if(!window.JSONRequest){var JSONRequest={};}function JSONRequestError(a){this.name='JSONRequestError';this.message=a;}JSONRequest.serialize=function(a){var b=/[\/"\\\x00-\x1f\x7f-\x9f]/g;var c={'\b':'\\b','\t':'\\t','\n':'\\n','\f':'\\f','\r':'\\r','"':'\\"','\\':'\\\\','/':'\\/'};switch(typeof a){case 'string':return '"'+(b.test(a)?a.replace(b,function(d){var e=c[d];if(typeof e==='string'){return e;}e=d.charCodeAt();return '\\u00'+Math.floor(e/16).toString(16)+(e%16).toString(16);}):a)+'"';case 'object':if(a){if(a instanceof Date){function f(g){return g<10?'0'+g:g;};return '"'+a.getFullYear()+'-'+f(a.getMonth()+1)+'-'+f(a.getDate())+'T'+f(a.getHours())+':'+f(a.getMinutes())+':'+f(a.getSeconds())+'"';}else{if(a.constructor==Array){var h=[];for(var i=0;i<a.length;i++){h.push(this.serialize(a[i]));}return '['+h.join(',')+']';}else{var h=['{'];var j=false;for(var k in a){if(a.hasOwnProperty(k)){var l=a[k];switch(typeof l){case 'undefined':case 'function':case 'unknown':break;default:if(j){h.push(',');}j=true;h.push(this.serialize(k)+':'+this.serialize(l));}}}h.push('}');return h.join('');}}}else{return 'null';}case 'number':return isFinite(a)?String(a):'null';case 'boolean':case 'null':return String(a);default:return '';}};JSONRequest.parse=function(_u_){if(/^[\],:{}\s]*$/.test(_u_.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,'@').replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,']').replace(/(?:^|:|,)(?:\s*\[)+/g,''))){return eval('('+_u_+')');}else{throw new SyntaxError('Malformed JSON string');}};JSONRequest.post=function(U_,a,_X_,bg_){var b=/^(((\w+):\/{2})?([-+\.\w]+(:[-+\.\w]+)?@)?(\w[^\s\/\\]*)\/?)?(\S*)$/.exec(U_);if(!b){throw new JSONRequestError('bad URL');}var b1_=b[6];var k_=typeof (a);if(k_!='object'&&k_!='string'){throw new JSONRequestError('bad data');}var _u_=this.serialize(a);if(typeof (_X_)!='function'){throw new JSONRequestError('bad function');}if(typeof (bg_)!='number'){bg_=10000;}if(isNaN(bg_)||(bg_<=0)){throw new JSONRequestError('bad timeout');}var N_=this.j5_++;var n_=b1_ in this.eO_?this.eO_[b1_]:new JSONRequest.j6_(b1_);this._k_[N_]=n_;n_.post(U_,_u_,_X_,bg_,N_);return N_;};JSONRequest.get=function(U_,_X_){var a=/^(((\w+):\/{2})?([-+\.\w]+(:[-+\.\w]+)?@)?(\w[^\s\/\\]*)\/?)?(\S*)$/.exec(U_);if(!a){throw new JSONRequestError('bad URL');}var b1_=a[6];if(typeof (_X_)!='function'){throw new JSONRequestError('bad function');}var N_=this.j5_++;var n_=b1_ in this.eO_?this.eO_[b1_]:new JSONRequest.j6_(b1_);this._k_[N_]=n_;n_.get(U_,_X_,N_);return N_;};JSONRequest.cancel=function(N_){if(N_ in this._k_){this._k_[N_].cancel(N_);}};JSONRequest.eO_={};JSONRequest.j5_=0;JSONRequest._k_={};JSONRequest.gi_=function(N_){if(N_ in this._k_){delete this._k_[N_];}};JSONRequest.j6_=function(b1_){this.ax_=new XMLHttpRequest();this.b1_=b1_;this._k_=new Array();this.N_=-1;this.gj_=-1;var n_=this;this.ax_.onreadystatechange=function(){if(n_.ax_.readyState==4){window.clearTimeout(n_.eP_);for(var a=n_._k_[0];a&&(a.N_!=n_.N_);a=n_._k_.shift()){JSONRequest.gi_(a.N_);}if(!a){return;}if(n_.ax_.status==200){if(!/^application\/jsonrequest($|\s|;)/.test(n_.ax_.getResponseHeader('Content-Type'))){a._X_(n_.N_,null,new JSONRequestError('bad response'));}else{if(n_.ax_.responseText!=null){var b=false;try{var c=JSONRequest.parse(n_.ax_.responseText);}catch(p_){b=true;}if(!b){a._X_(n_.N_,c,null);}else{a._X_(n_.N_,null,new JSONRequestError('bad response'));}}else{a._X_(n_.N_,null,new JSONRequestError('no response'));}}}else{if(n_.gj_!=n_.N_){a._X_(n_.N_,null,new JSONRequestError('not ok'));}}if(n_.gj_!=n_.N_){n_._k_.shift();delete JSONRequest._k_[n_.N_];n_.N_=-1;n_.dW_();}}};this.post=function(U_,_u_,_X_,bg_,N_){var d=!this._k_.length;this._k_.push({U_:U_,_X_:_X_,bg_:bg_,N_:N_,_o_:'POST'});if(d){this.dW_(_u_);}else{this._k_[this._k_.length-1]['sData']=_u_;this.dW_();}};this.get=function(U_,_X_,N_){this._k_.push({U_:U_,_X_:_X_,N_:N_,_o_:'GET',bg_:30000});this.dW_();};this.dW_=function(){if(!this._k_.length){return;}var L_=this._k_[0];while(this._k_.length&&!L_){this._k_.shift();L_=this._k_[0];}if(!this._k_.length){return;}if(L_.N_==this.N_){return;}var e=this;this.eP_=window.setTimeout(function(){e.cancel(e.N_,true);},L_.bg_);this.N_=L_.N_;try{this.ax_.open(L_._o_,L_.U_,true);this.ax_.setRequestHeader('Content-Type','application/jsonrequest');this.ax_.setRequestHeader('Content-Encoding','identity');this.ax_.setRequestHeader('Domain',this.b1_);if(arguments.length>=1){this.ax_.send(arguments[0]);}else{if('sData' in L_){this.ax_.send(L_._u_);}else{this.ax_.send(null);}}}catch(p_){window.clearTimeout(this.eP_);throw p_;}};this.cancel=function(N_){var a=null;var f=arguments.length>1?arguments[1]:false;this.gj_=N_;if(this.N_==N_){this.ax_.abort();a=this._k_.shift();if(!f){window.clearTimeout(this.eP_);}a._X_(N_,null,new JSONRequestError(f?'no response':'cancelled'));this.N_=-1;JSONRequest.gi_(N_);this.dW_();}else{for(var g=0;g<this._k_.length;g++){if(this._k_[g]&&(this._k_[g].N_==N_)){a=this._k_[g];delete this._k_[g];break;}}JSONRequest.gi_(N_);if(a){if(!f){window.clearTimeout(this.eP_);}a._X_(N_,null,new JSONRequestError(f?'no response':'cancelled'));}}};};