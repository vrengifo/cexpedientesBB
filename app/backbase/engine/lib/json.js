if(!window.JSONRequest){var JSONRequest={};}function JSONRequestError(a){this.name='JSONRequestError';this.message=a;}JSONRequest.serialize=function(a){var b=/[\/"\\\x00-\x1f\x7f-\x9f]/g;var c={'\b':'\\b','\t':'\\t','\n':'\\n','\f':'\\f','\r':'\\r','"':'\\"','\\':'\\\\','/':'\\/'};switch(typeof a){case 'string':return '"'+(b.test(a)?a.replace(b,function(d){var e=c[d];if(typeof e==='string'){return e;}e=d.charCodeAt();return '\\u00'+Math.floor(e/16).toString(16)+(e%16).toString(16);}):a)+'"';case 'object':if(a){if(a instanceof Date){function f(g){return g<10?'0'+g:g;};return '"'+a.getFullYear()+'-'+f(a.getMonth()+1)+'-'+f(a.getDate())+'T'+f(a.getHours())+':'+f(a.getMinutes())+':'+f(a.getSeconds())+'"';}else{if(a.constructor==Array){var h=[];for(var i=0;i<a.length;i++){h.push(this.serialize(a[i]));}return '['+h.join(',')+']';}else{var h=['{'];var j=false;for(var k in a){if(a.hasOwnProperty(k)){var l=a[k];switch(typeof l){case 'undefined':case 'function':case 'unknown':break;default:if(j){h.push(',');}j=true;h.push(this.serialize(k)+':'+this.serialize(l));}}}h.push('}');return h.join('');}}}else{return 'null';}case 'number':return isFinite(a)?String(a):'null';case 'boolean':case 'null':return String(a);default:return '';}};JSONRequest.parse=function(_s_){if(/^[\],:{}\s]*$/.test(_s_.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,'@').replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,']').replace(/(?:^|:|,)(?:\s*\[)+/g,''))){return eval('('+_s_+')');}else{throw new SyntaxError('Malformed JSON string');}};JSONRequest.post=function(V_,a,a1_,bp_){var b=/^(((\w+):\/{2})?([-+\.\w]+(:[-+\.\w]+)?@)?(\w[^\s\/\\]*)\/?)?(\S*)$/.exec(V_);if(!b){throw new JSONRequestError('bad URL');}var b8_=b[6];var l_=typeof (a);if(l_!='object'&&l_!='string'){throw new JSONRequestError('bad data');}var _s_=this.serialize(a);if(typeof (a1_)!='function'){throw new JSONRequestError('bad function');}if(typeof (bp_)!='number'){bp_=10000;}if(isNaN(bp_)||(bp_<=0)){throw new JSONRequestError('bad timeout');}var P_=this.jp_++;var n_=b8_ in this.f2_?this.f2_[b8_]:new JSONRequest.jq_(b8_);this._m_[P_]=n_;n_.post(V_,_s_,a1_,bp_,P_);return P_;};JSONRequest.get=function(V_,a1_){var a=/^(((\w+):\/{2})?([-+\.\w]+(:[-+\.\w]+)?@)?(\w[^\s\/\\]*)\/?)?(\S*)$/.exec(V_);if(!a){throw new JSONRequestError('bad URL');}var b8_=a[6];if(typeof (a1_)!='function'){throw new JSONRequestError('bad function');}var P_=this.jp_++;var n_=b8_ in this.f2_?this.f2_[b8_]:new JSONRequest.jq_(b8_);this._m_[P_]=n_;n_.get(V_,a1_,P_);return P_;};JSONRequest.cancel=function(P_){if(P_ in this._m_){this._m_[P_].cancel(P_);}};JSONRequest.f2_={};JSONRequest.jp_=0;JSONRequest._m_={};JSONRequest.gv_=function(P_){if(P_ in this._m_){delete this._m_[P_];}};JSONRequest.jq_=function(b8_){this.aC_=new XMLHttpRequest();this.b8_=b8_;this._m_=new Array();this.P_=-1;this.gw_=-1;var n_=this;this.aC_.onreadystatechange=function(){if(n_.aC_.readyState==4){window.clearTimeout(n_.f3_);for(var a=n_._m_[0];a&&(a.P_!=n_.P_);a=n_._m_.shift()){JSONRequest.gv_(a.P_);}if(!a){return;}if(n_.aC_.status==200){if(!/^application\/jsonrequest($|\s|;)/.test(n_.aC_.getResponseHeader('Content-Type'))){a.a1_(n_.P_,null,new JSONRequestError('bad response'));}else{if(n_.aC_.responseText!=null){var b=false;try{var c=JSONRequest.parse(n_.aC_.responseText);}catch(o_){b=true;}if(!b){a.a1_(n_.P_,c,null);}else{a.a1_(n_.P_,null,new JSONRequestError('bad response'));}}else{a.a1_(n_.P_,null,new JSONRequestError('no response'));}}}else{if(n_.gw_!=n_.P_){a.a1_(n_.P_,null,new JSONRequestError('not ok'));}}if(n_.gw_!=n_.P_){n_._m_.shift();delete JSONRequest._m_[n_.P_];n_.P_=-1;n_.e5_();}}};this.post=function(V_,_s_,a1_,bp_,P_){var d=!this._m_.length;this._m_.push({V_:V_,a1_:a1_,bp_:bp_,P_:P_,_n_:'POST'});if(d){this.e5_(_s_);}else{this._m_[this._m_.length-1]['sData']=_s_;this.e5_();}};this.get=function(V_,a1_,P_){this._m_.push({V_:V_,a1_:a1_,P_:P_,_n_:'GET',bp_:30000});this.e5_();};this.e5_=function(){if(!this._m_.length){return;}var N_=this._m_[0];while(this._m_.length&&!N_){this._m_.shift();N_=this._m_[0];}if(!this._m_.length){return;}if(N_.P_==this.P_){return;}var e=this;this.f3_=window.setTimeout(function(){e.cancel(e.P_,true);},N_.bp_);this.P_=N_.P_;try{this.aC_.open(N_._n_,N_.V_,true);this.aC_.setRequestHeader('Content-Type','application/jsonrequest');this.aC_.setRequestHeader('Content-Encoding','identity');this.aC_.setRequestHeader('Domain',this.b8_);if(arguments.length>=1){this.aC_.send(arguments[0]);}else{if('sData' in N_){this.aC_.send(N_._s_);}else{this.aC_.send(null);}}}catch(o_){window.clearTimeout(this.f3_);throw o_;}};this.cancel=function(P_){var a=null;var f=arguments.length>1?arguments[1]:false;this.gw_=P_;if(this.P_==P_){this.aC_.abort();a=this._m_.shift();if(!f){window.clearTimeout(this.f3_);}a.a1_(P_,null,new JSONRequestError(f?'no response':'cancelled'));this.P_=-1;JSONRequest.gv_(P_);this.e5_();}else{for(var g=0;g<this._m_.length;g++){if(this._m_[g]&&(this._m_[g].P_==P_)){a=this._m_[g];delete this._m_[g];break;}}JSONRequest.gv_(P_);if(a){if(!f){window.clearTimeout(this.f3_);}a.a1_(P_,null,new JSONRequestError(f?'no response':'cancelled'));}}};};